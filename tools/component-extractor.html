<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <script>
    function collectDefs (node, defs, treeNode) {
      if (node.nodeName === '#text') {
        return
      }
      treeNode.nodeName = node.nodeName
      var re = /^url\(#(.*)\)/i;
      var attrs = []
      for (var attr of node.attributes) {
        var value = attr.value
        if (attr.name === 'xlink:href') {
          var id = value.substr(1)
          defs.add(id) 
          value = (idMap) => "'#' + " + idMap[id]
        } else if (attr.name === 'id' && node.nodeName === 'mask') {
          var id = attr.value
          defs.add(id) 
          value = (idMap) => idMap[id]
        } else {
          var found = value.match(re);
          if (found) {
            var id = found[1]
            value = (idMap) => '`url(#${' + idMap[id] +'})`'
            defs.add(id)
          }
        }

        attrs.push({
          name: attr.name,
          value
        })
      }
      treeNode.attrs = attrs

      var children = []
      for (var child of node.childNodes) {
        var childNode = {}
        collectDefs(child, defs, childNode)
        if (childNode.nodeName) {
          children.push(childNode)
        }
      }
      treeNode.childNodes = children
    }

    function convertDef (node, treeNode) {
      if (node.nodeName === '#text') {
        return
      }
      treeNode.nodeName = node.nodeName
      var attrs = []
      for (var attr of node.attributes) {
        var value = attr.value
        if (attr.name === 'id') {
          var id = attr.value
          value = (idMap) => idMap[id]
        }
        attrs.push({
          name: attr.name,
          value
        })
      }
      treeNode.attrs = attrs

      var children = []
      for (var child of node.childNodes) {
        var childNode = {}
        convertDef(child, childNode)
        if (childNode.nodeName) {
          children.push(childNode)
        }
      }
      treeNode.childNodes = children
    }

    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    function outputNode(node, idMap) {
      var result = `<${node.nodeName} `
      var attrs = []
      for (var attr of node.attrs) {
        var { name, value } = attr
        var nameParts = name.split('-')
        if (nameParts.length > 1) {
          name = nameParts[0] + nameParts.slice(1).map(n => capitalizeFirstLetter(n))
        }
        var nameParts2 = name.split(':')
        if (nameParts2.length > 1) {
          name = nameParts2[0] + nameParts2.slice(1).map(n => capitalizeFirstLetter(n))
        }

        if (typeof value === 'function') {
          value = value(idMap)
          attrs.push(`${name}={${value}}`)
        } else {
          if (name === 'id' && value.startsWith('Top/_Resources/')) {
            return '{this.props.children}'
          }
          attrs.push(`${name}='${value}'`)
        }
      }
      result += attrs.join(' ') + '>'
      for (var child of node.childNodes) {
        result += outputNode(child, idMap) 
      }
      result += `</${node.nodeName}>`
      return result
    }
  
    document.addEventListener('DOMContentLoaded', () => {
      var top = document.getElementById('Top')
      var defs = new Set()
      var treeNode = {}
      collectDefs(top, defs, treeNode) 

      var defsNodes = []
      for (var id of defs) {
        var node = document.getElementById(id)
        var defTreeNode = {}
        convertDef(node, defTreeNode)
        defsNodes.push(defTreeNode)
      }

      var typeCount = {}
      var idMap = {}
      var idProps = []
      const sortedDefs = Array.from(defs)
      var newIDs = []
      sortedDefs.sort()
      for (var id of sortedDefs) {
        var parts = id.split('-')
        var type = parts[0]
        var num = parts[1]
        if (!(type in typeCount)) {
          typeCount[type] = 1
        } else {
          typeCount[type] += 1
        }
        const newID = type + typeCount[type]
        newIDs.push(newID)
        idProps.push(`  private ${newID} = uniqueId('react-${type}-')`)
        idMap[id] = newID
      }

      //console.info('$$$$$', defsNodes)
      // console.info('$$$$$', defsStr)
      // console.info(defs, treeNode)
      treeNode.childNodes.unshift({
        nodeName: 'defs',
        attrs: [],
        childNodes: defsNodes.filter(n => n.nodeName !== 'mask')
      })

      newIDs.sort()
      const dom = outputNode(treeNode, idMap)
      const output = `
import * as React from 'react'
import { uniqueId } from 'lodash'

export default class FIXME extends React.Component {
  ${idProps.join('\n')} 

  render () {
    const { ${newIDs.join(', ')} } = this
    return (
      ${dom}
    )
  }
}

      `
      document.getElementById('output-text').value = output
    })
  
  </script>
</head>

<body>


    <svg width="264px" height="280px" viewBox="0 0 264 280" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
      <desc>Created with Sketch.</desc>
      <defs>
          <rect id="path-1" x="0" y="0" width="264" height="280"></rect>
          <path d="M124,144.610951 L124,163 L128,163 L128,163 C167.764502,163 200,195.235498 200,235 L200,244 L0,244 L0,235 C-4.86974701e-15,195.235498 32.235498,163 72,163 L72,163 L76,163 L76,144.610951 C58.7626345,136.422372 46.3722246,119.687011 44.3051388,99.8812385 C38.4803105,99.0577866 34,94.0521096 34,88 L34,74 C34,68.0540074 38.3245733,63.1180731 44,62.1659169 L44,56 L44,56 C44,25.072054 69.072054,5.68137151e-15 100,0 L100,0 L100,0 C130.927946,-5.68137151e-15 156,25.072054 156,56 L156,62.1659169 C161.675427,63.1180731 166,68.0540074 166,74 L166,88 C166,94.0521096 161.51969,99.0577866 155.694861,99.8812385 C153.627775,119.687011 141.237365,136.422372 124,144.610951 Z" id="path-2"></path>
          <path d="M181.544255,32.3304167 C210.784209,41.4878872 232,68.7921987 232,101.051724 L232,110 L32,110 L32,101.051724 C32,68.3969699 53.7388273,40.8195914 83.5340368,32.0020332 C83.182234,33.4201865 83,34.8712315 83,36.3476251 C83,52.6289957 105.161905,65.8276544 132.5,65.8276544 C159.838095,65.8276544 182,52.6289957 182,36.3476251 C182,34.9849859 181.844766,33.6439396 181.544255,32.3304167 Z" id="path-4"></path>
          <rect id="path-6" x="0" y="0" width="264" height="280"></rect>
          <path d="M8.46130289,88.6935361 C8.16088005,89.7438903 8,90.8531574 8,92 L8,105 C8,111.018625 12.4308707,116.002364 18.2085808,116.867187 C19.9518066,137.114792 32.4692178,154.282984 50,162.610951 L50,181 L46,181 L46,181 C30.3810228,181 15.9236322,185.973344 4.12503673,194.422823 C1.45272918,186.776619 1.52589027e-14,178.557961 1.42108547e-14,170 L0,74 L0,74 C-5.00501776e-15,33.1309285 33.1309285,7.50752664e-15 74,0 L74,0 L74,0 C114.869071,-7.50752664e-15 148,33.1309285 148,74 L148,170 C148,178.557961 146.547271,186.776619 143.874963,194.422823 C132.076368,185.973344 117.618977,181 102,181 L102,181 L98,181 L98,162.610951 C115.530782,154.282984 128.048193,137.114792 129.791419,116.867187 C135.569129,116.002364 140,111.018625 140,105 L140,92 C140,90.3107559 139.650957,88.7030352 139.021057,87.2450254 C126.064756,85.0568849 111.478699,79.7686298 97.1489304,71.4953343 C85.0171781,64.4910638 74.6464677,56.2579416 66.6695083,47.752196 C70.0963393,55.6604321 74.2459335,62.5880409 79.118291,68.5350224 C66.4431108,63.0120855 57.8126345,54.1324394 53.2268621,41.8960843 C52.8490267,42.8180234 52.455505,43.738913 52.0461952,44.6582378 C42.206947,66.7575512 25.5911314,82.6819966 8.46130289,88.6935361 Z" id="path-8"></path>
      </defs>
      <g id="How-To-Use" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
          <g transform="translate(-825.000000, -1100.000000)" id="Avataaar/Default">
              <g transform="translate(825.000000, 1100.000000)">
                  <g id="Rectangle">
                      <use fill="#D8D8D8" fill-rule="evenodd" xlink:href="#path-1"></use>
                      <rect stroke="#979797" stroke-width="1" x="0.5" y="0.5" width="263" height="279"></rect>
                  </g>
                  <g id="Body" stroke-width="1" fill-rule="evenodd" transform="translate(32.000000, 36.000000)">
                      <mask id="mask-3" fill="white">
                          <use xlink:href="#path-2"></use>
                      </mask>
                      <use fill="#D0C6AC" xlink:href="#path-2"></use>
                      <g id="Skin/👶🏽-03-Brown" mask="url(#mask-3)" fill="#D08B5B">
                          <g transform="translate(-32.000000, 0.000000)" id="Color">
                              <rect x="0" y="0" width="264" height="244"></rect>
                          </g>
                      </g>
                      <path d="M156,79 L156,102 C156,132.927946 130.927946,158 100,158 C69.072054,158 44,132.927946 44,102 L44,79 L44,94 C44,124.927946 69.072054,150 100,150 C130.927946,150 156,124.927946 156,94 L156,79 Z" id="Neck-Shadow" fill-opacity="0.100000001" fill="#000000" mask="url(#mask-3)"></path>
                  </g>
                  <g id="Clothing/Shirt-Scoop-Neck" transform="translate(0.000000, 170.000000)">
                      <mask id="mask-5" fill="white">
                          <use xlink:href="#path-4"></use>
                      </mask>
                      <use id="Clothes" fill="#E6E6E6" fill-rule="evenodd" xlink:href="#path-4"></use>
                      <g id="Color/Palette/Gray-01" mask="url(#mask-5)" fill-rule="evenodd" fill="#E6E6E6">
                          <rect id="🖍Color" x="0" y="0" width="264" height="110"></rect>
                      </g>
                  </g>
                  <g id="Face" stroke-width="1" fill-rule="evenodd" transform="translate(76.000000, 82.000000)" fill="#000000">
                      <g id="Mouth/Default" transform="translate(2.000000, 52.000000)" fill-opacity="0.699999988">
                          <path d="M40,15 C40,22.7319865 46.2680135,29 54,29 L54,29 C61.7319865,29 68,22.7319865 68,15" id="Mouth"></path>
                      </g>
                      <g id="Nose/Default" transform="translate(28.000000, 40.000000)" fill-opacity="0.16">
                          <path d="M16,8 C16,12.418278 21.372583,16 28,16 L28,16 C34.627417,16 40,12.418278 40,8" id="Nose"></path>
                      </g>
                      <g id="Eyes/Default-😀" transform="translate(0.000000, 8.000000)" fill-opacity="0.599999964">
                          <circle id="Eye" cx="30" cy="22" r="6"></circle>
                          <circle id="Eye" cx="82" cy="22" r="6"></circle>
                      </g>
                      <g id="Eyebrow/Outline/Default" fill-opacity="0.599999964">
                          <g id="I-Browse" transform="translate(12.000000, 6.000000)">
                              <path d="M3.63024536,11.1585767 C7.54515501,5.64986673 18.2779197,2.56083721 27.5230268,4.83118046 C28.5957248,5.0946055 29.6788665,4.43856013 29.9422916,3.36586212 C30.2057166,2.2931641 29.5496712,1.21002236 28.4769732,0.94659732 C17.7403633,-1.69001789 5.31209962,1.88699832 0.369754639,8.84142326 C-0.270109626,9.74178291 -0.0589363917,10.9903811 0.84142326,11.6302454 C1.74178291,12.2701096 2.9903811,12.0589364 3.63024536,11.1585767 Z" id="Eyebrow" fill-rule="nonzero"></path>
                              <path d="M61.6302454,11.1585767 C65.545155,5.64986673 76.2779197,2.56083721 85.5230268,4.83118046 C86.5957248,5.0946055 87.6788665,4.43856013 87.9422916,3.36586212 C88.2057166,2.2931641 87.5496712,1.21002236 86.4769732,0.94659732 C75.7403633,-1.69001789 63.3120996,1.88699832 58.3697546,8.84142326 C57.7298904,9.74178291 57.9410636,10.9903811 58.8414233,11.6302454 C59.7417829,12.2701096 60.9903811,12.0589364 61.6302454,11.1585767 Z" id="Eyebrow" fill-rule="nonzero" transform="translate(73.000154, 6.039198) scale(-1, 1) translate(-73.000154, -6.039198) "></path>
                          </g>
                      </g>
                  </g>
                  <g id="Top" stroke-width="1" fill-rule="evenodd">
                      <mask id="mask-7" fill="white">
                          <use xlink:href="#path-6"></use>
                      </mask>
                      <g id="Mask"></g>
                      <g id="Top/Long-Hair/Straight-+-Strand" mask="url(#mask-7)">
                          <g transform="translate(-1.000000, 0.000000)">
                              <g id="Hair" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(59.000000, 18.000000)">
                                  <mask id="mask-9" fill="white">
                                      <use xlink:href="#path-8"></use>
                                  </mask>
                                  <use fill="#ECC797" xlink:href="#path-8"></use>
                                  <g id="Color/Hair/Brown-Dark" mask="url(#mask-9)" fill="#4A312C">
                                      <g transform="translate(-58.000000, -18.000000)" id="Color">
                                          <rect x="0" y="0" width="264" height="280"></rect>
                                      </g>
                                  </g>
                              </g>
                              <path d="M59,102.418954 L59,108.837908 C78.9453743,105.750496 99.5895621,88.3902571 111.046195,62.6582378 C111.455505,61.738913 111.849027,60.8180234 112.226862,59.8960843 C116.231662,70.5822127 123.321236,78.70828 133.495584,84.2742862 C134.956498,86.4697241 136.497401,88.5566361 138.118291,90.5350224 C125.443111,85.0120855 116.812635,76.1324394 112.226862,63.8960843 C111.849027,64.8180234 111.455505,65.738913 111.046195,66.6582378 C99.5895621,92.3902571 78.9453743,109.750496 59,112.837908 L59,102.418954 Z M207,101.140388 L207,110.280776 C192.046922,109.412723 173.901259,103.744646 156.14893,93.4953343 C145.87623,87.5643877 136.866205,80.7523483 129.502994,73.639773 C128.137922,71.1289501 126.860094,68.4997578 125.669508,65.752196 C133.646468,74.2579416 144.017178,82.4910638 156.14893,89.4953343 C173.901259,99.7446457 192.046922,105.412723 207,106.280776 L207,101.140388 Z" id="Shadow" fill-opacity="0.16" fill="#000000" fill-rule="evenodd"></path>
                              <g id="Top/_Resources/Blank" fill="none" transform="translate(62.000000, 85.000000)"></g>
                          </g>
                      </g>
                  </g>
              </g>
          </g>
      </g>
  </svg>

<textarea id='output-text'></textarea>

</body>
</html>